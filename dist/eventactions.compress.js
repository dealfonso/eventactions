/* Copyright 2023 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
!function(exports){void 0===exports&&(exports=window);let DEFAULT_OPTIONS_ACTION={condition:null,conditionAction:null,confirm:null,confirmAcceptText:"OK",confirmCancelText:"Cancel",execute:null,target:null,targetChildren:null,classAdd:null,classRemove:null,classToggle:null,classSet:null,scrollTo:null,contentMethod:"innerHTML",contentSet:null,contentAppend:null,contentPrepend:null,contentClear:null,delay:0,acknowledge:null,acknowledgeButton:"OK",splash:null};async function executeAction(el,actionOptions){actionOptions=Object.assign({},EventActions.defaultActionOptions,actionOptions||{});let targetElements=[],targetSelector=sanitizeValue(actionOptions.target||null),targetChildrenSelector=sanitizeValue(actionOptions.targetChildren||null);if(null===targetSelector&&null===targetChildrenSelector)targetElements=[el];else{if(targetSelector)try{targetElements=[...targetElements,...document.querySelectorAll(targetSelector)]}catch(error){console.warn(`Error selecting elements with selector "${targetSelector}"`,error)}if(targetChildrenSelector)try{targetElements=[...targetElements,...el.querySelectorAll(targetChildrenSelector)]}catch(error){console.warn(`Error selecting children with selector "${targetChildrenSelector}"`,error)}}let condition=sanitizeValue(actionOptions.condition||null);if(condition){if("function"==typeof condition)return result=condition.bind(el)(targetElements),!!result;try{let result=function(){return eval(condition)}.bind(el)(targetElements);if("function"==typeof result&&(result=result.bind(el)(targetElements)),!result)return!1}catch(error){return console.error(`Error evaluating condition "${condition}":`,error),!1}}let conditionAction=sanitizeValue(actionOptions.conditionAction||null),shouldSkipAction=!1;if(conditionAction){if("function"==typeof conditionAction&&(result=conditionAction.bind(el)(targetElements),!result))return!0;try{let result=function(){return eval(conditionAction)}.bind(el)(targetElements);"function"==typeof result&&(result=result.bind(el)(targetElements)),result||(shouldSkipAction=!0)}catch(error){console.error(`Error evaluating action condition "${conditionAction}":`,error),shouldSkipAction=!0}}if(shouldSkipAction)return!0;let confirmMessage=sanitizeValue(actionOptions.confirm||null);if(confirmMessage){let confirmAcceptText=sanitizeValue(actionOptions.confirmAcceptText||"OK"),confirmCancelText=sanitizeValue(actionOptions.confirmCancelText||"Cancel");try{await confirmDialog(confirmMessage,confirmAcceptText,confirmCancelText)}catch(error){return!1}}let execute=sanitizeValue(actionOptions.execute||null);if(execute)if("function"==typeof execute)execute.bind(el)(targetElements);else try{let result=function(){return eval(execute)}.bind(el)();"function"==typeof result&&(result=result.bind(el)(targetElements))}catch(error){console.error(`Error executing action "${execute}":`,error)}let classesAdd=sanitizeValue(actionOptions.classAdd||null),classesRemove=sanitizeValue(actionOptions.classRemove||null),classesToggle=sanitizeValue(actionOptions.classToggle||null),classesSet=sanitizeValue(actionOptions.classSet||null),classListAdd=classesAdd?classesAdd.split(/\s+/).filter(e=>""!==e.trim()):[],classListRemove=classesRemove?classesRemove.split(/\s+/).filter(e=>""!==e.trim()):[],classListToggle=classesToggle?classesToggle.split(/\s+/).filter(e=>""!==e.trim()):[],classListSet=classesSet?classesSet.split(/\s+/).filter(e=>""!==e.trim()):[],intersectionSR=classListAdd.filter(e=>classListRemove.includes(e)),intersectionST=classListAdd.filter(e=>classListToggle.includes(e)),intersectionRT=classListRemove.filter(e=>classListToggle.includes(e));if(0<intersectionSR.length||0<intersectionST.length||0<intersectionRT.length)return console.warn("Cannot set, unset or toggle the same class at the same time:",{classListAdd:classListAdd,classListRemove:classListRemove,classListToggle:classListToggle}),!1;let applyClasses=()=>{for(let t of targetElements)0<classListSet.length?(t.classList.remove(...t.classList),classListSet.forEach(e=>{t.classList.add(e)})):(0<classListToggle.length&&classListToggle.forEach(e=>{t.classList.toggle(e)}),0<classListAdd.length&&classListAdd.forEach(e=>{t.classList.add(e)}),0<classListRemove.length&&classListRemove.forEach(e=>{t.classList.remove(e)}))},contentMethod=sanitizeValue(actionOptions.contentMethod||"innerHTML");if(["innerHTML","textContent"].includes(contentMethod)){let contentSet=sanitizeValue(actionOptions.contentSet||null),contentAppend=sanitizeValue(actionOptions.contentAppend||null),contentPrepend=sanitizeValue(actionOptions.contentPrepend||null),contentClear=!0===actionOptions.contentClear||"true"===actionOptions.contentClear||""===actionOptions.contentClear,applyContentChanges=()=>{for(var e of targetElements)contentClear&&(e[contentMethod]=""),contentSet&&(e[contentMethod]=contentSet),contentAppend&&(e[contentMethod]+=contentAppend),contentPrepend&&(e[contentMethod]=contentPrepend+e[contentMethod])};const scrollTo=sanitizeValue(actionOptions.scrollTo||null);scrollTo&&!["top","bottom","left","right"].includes(scrollTo)&&(console.warn("Invalid scroll-to value: "+scrollTo),scrollTo=null);let applyScroll=()=>{if(scrollTo)for(var e of targetElements){switch(scrollTo){case"top":e.scrollTop=0;break;case"bottom":e.scrollTop=e.scrollHeight;break;case"left":e.scrollLeft=0;break;case"right":e.scrollLeft=e.scrollWidth}break}},delay=parseFloat(actionOptions.delay)||0,acknowledgeMessage=(0<delay&&!isNaN(delay)&&await new Promise(e=>setTimeout(e,delay)),applyClasses(),applyContentChanges(),applyScroll(),sanitizeValue(actionOptions.acknowledge||null)),acknowledgeButton=sanitizeValue(actionOptions.acknowledgeButton||"OK");return acknowledgeMessage&&await messageDialog(acknowledgeMessage,acknowledgeButton),!0}console.warn("Invalid content method: "+contentMethod)}function removeEventActions(e,t=null){if(e&&e._eventActions)if(t)e._eventActions[t]&&(e._eventActions.handlers&&e._eventActions.handlers[t]&&(e.removeEventListener(t,e._eventActions.handlers[t]),delete e._eventActions.handlers[t]),e._eventActions[t]?(e["on"+t]=e._eventActions[t],delete e._eventActions[t]):e["on"+t]=null,e._eventActions.handlers)&&0===Object.keys(e._eventActions.handlers).length&&delete e._eventActions;else for(var n in e._eventActions)removeEventActions(e,n)}function addEventActions(e,c="click",t="ca"){var n,a,i;!e||e._eventActions&&e._eventActions[c]||(e._eventActions=e._eventActions||{},e._eventActions[c]=e["on"+c]||null,e["on"+c]=null,a=e=e,i=t,e.addEventListener(t=c,n=async function(e){e.preventDefault(),e.stopPropagation();let t=!0,n=null,o=getElementOptions(a,EventActions.defaultActionOptions,i,!0),l=(o&&0<Object.keys(o).length&&(o=Object.assign({},EventActions.defaultActionOptions,o||{}),t=await executeAction(a,o))&&o.splash&&(n&&(n.modal.hide(),n=null),n=splashDialog(o.splash)),1);for(;t&&(o=getElementOptions(a,EventActions.defaultActionOptions,i+"-"+l,!0))&&0<Object.keys(o).length;){var s=null===o.splash||""===o.splash||"false"===o.splash||"0"===o.splash||!1===o.splash;o=Object.assign({},EventActions.defaultActionOptions,o||{}),t=await executeAction(a,o),s&&n&&(n.modal.hide(),n=null),t&&o.splash&&(n&&(n.modal.hide(),n=null),n=splashDialog(o.splash)),l++}t&&(o=getElementOptions(a,EventActions.defaultActionOptions,i+"-last",!0))&&0<Object.keys(o).length&&(o=Object.assign({},EventActions.defaultActionOptions,o||{}),await executeAction(a,o),null===o.splash&&n&&(n.modal.hide(),n=null),t)&&o.splash&&(n&&(n.modal.hide(),n=null),n=splashDialog(o.splash)),(o=getElementOptions(a,EventActions.defaultActionOptions,i+"-finally",!0))&&0<Object.keys(o).length&&(o=Object.assign({},EventActions.defaultActionOptions,o||{}),await executeAction(a,o),null===o.splash&&n&&(n.modal.hide(),n=null),t)&&o.splash&&(n&&(n.modal.hide(),n=null),n=splashDialog(o.splash)),t&&a._eventActions&&a._eventActions[c]&&a._eventActions[c].bind(a)(e),n&&n.modal.hide()}),e._eventActions.handlers=e._eventActions.handlers||{},e._eventActions.handlers[t]=n)}let EventActions={execute:executeAction,addEventActions:addEventActions,addClickActions:e=>addEventActions(e,"click","ca"),addScrollActions:e=>addEventActions(e,"scroll","sa"),removeEventActions:removeEventActions,removeClickActions:e=>removeEventActions(e,"click"),removeScrollActions:e=>removeEventActions(e,"scroll"),defaultActionOptions:DEFAULT_OPTIONS_ACTION,version:"1.0.0"};function snakeToCamelCase(e){e.replace(/-([a-z])/g,e=>e[1].toUpperCase())}function camelToSnakeCase(e){return(e=(e=(e=e.replace(/([0-9]+)/g,e=>"-"+e)).replace(/[A-Z]/g,e=>"-"+e[0].toLowerCase())).replace(/--+/g,"-")).replace(/^-+/,"").replace(/-+$/,"")}function sanitizeValue(e){return null==e||"string"==typeof e&&""===(e=e.trim())?null:e}function getElementOptions(e,t,n,o=!1){var l,s={},c=n?camelToSnakeCase(n)+"-":"";for(l of Object.keys(t)){var a=c+camelToSnakeCase(l),a=e.dataset[a]||e.getAttribute("data-"+a);null!=a?"boolean"==typeof t[l]?s[l]="true"===a.toLowerCase():"number"==typeof t[l]?s[l]=parseFloat(a):s[l]=a:o||(s[l]=t[l])}return s}document.addEventListener("DOMContentLoaded",()=>{var e=Object.keys(EventActions.defaultActionOptions).map(e=>`[data-ca-${camelToSnakeCase(e)}],[data-ca-1-${camelToSnakeCase(e)}]`).join(","),t=Object.keys(EventActions.defaultActionOptions).map(e=>`[data-sa-${camelToSnakeCase(e)}],[data-sa-1-${camelToSnakeCase(e)}]`).join(",");document.querySelectorAll(""+e).forEach(e=>{addEventActions(e,"click","ca")}),document.querySelectorAll(""+t).forEach(e=>{addEventActions(e,"scroll","sa")})}),exports.EventActions=EventActions;let DEFAULT_MODAL_OPTIONS={title:null,body:null,btnAcceptText:"Accept",btnCancelText:"Cancel",btnAcceptClass:"btn-primary",btnCancelClass:"btn-secondary",size:"md",centered:!0,backdrop:"static",keyboard:!0,focus:!0,onAccept:null,onCancel:null,onShow:null,onShown:null,onHide:null,onHidden:null,autoShow:!0};function confirmDialog(n,e="Accept",t="Cancel",o=null){return bsCreateModal({title:o,body:n,btnAcceptText:e,btnCancelText:t})||new Promise((e,t)=>{window.confirm(n)?e(!0):t(!1)})}function messageDialog(t,e="OK",n=null){return bsCreateModal({title:n,body:t,btnAcceptText:e,btnCancelText:null})||new Promise(e=>{window.alert(t),e(!0)})}function splashDialog(e='<div class="spinner-border" role="status" aria-hidden="true"></div>',t=null){return bsCreateModal({title:t,body:e,btnAcceptText:null,btnCancelText:null,backdrop:"static",keyboard:!1,focus:!1})}function bsCreateModal(o={}){if("undefined"==typeof bootstrap||!bootstrap.Modal)return console.warn("bsCreateModal: Bootstrap 5 is required for this function to work."),null;if(!((o=Object.assign({},DEFAULT_MODAL_OPTIONS,o||{})).title||o.body||o.btnAcceptText||o.btnCancelText))return console.error("bsCreateModal: At least one of title, body, btnAcceptText or btnCancelText must be provided"),null;-1===["sm","md","lg","xl","xxl"].indexOf(o.size)&&(o.size="md"),"md"===o.size?o.size="":o.size="modal-"+o.size,"boolean"!=typeof o.centered&&(o.centered=DEFAULT_MODAL_OPTIONS.centered),!0!==o.backdrop&&!1!==o.backdrop&&"static"!==o.backdrop&&(o.backdrop=DEFAULT_MODAL_OPTIONS.backdrop),"boolean"!=typeof o.keyboard&&(o.keyboard=DEFAULT_MODAL_OPTIONS.keyboard),"boolean"!=typeof o.focus&&(o.focus=DEFAULT_MODAL_OPTIONS.focus),null!==o.btnAcceptText&&"string"!=typeof o.btnAcceptText&&(o.btnAcceptText=DEFAULT_MODAL_OPTIONS.btnAcceptText),null!==o.btnCancelText&&"string"!=typeof o.btnCancelText&&(o.btnCancelText=DEFAULT_MODAL_OPTIONS.btnCancelText),!0!==o.autoShow&&!1!==o.autoShow&&(o.autoShow=DEFAULT_MODAL_OPTIONS.autoShow),o.btnAcceptText=sanitizeValue(o.btnAcceptText),o.btnCancelText=sanitizeValue(o.btnCancelText),o.title=sanitizeValue(o.title),o.body=sanitizeValue(o.body),o.onAccept&&"function"!=typeof o.onAccept&&(o.onAccept=null),o.onCancel&&"function"!=typeof o.onCancel&&(o.onCancel=null),o.onShow&&"function"!=typeof o.onShow&&(o.onShow=null),o.onShown&&"function"!=typeof o.onShown&&(o.onShown=null),o.onHide&&"function"!=typeof o.onHide&&(o.onHide=null),o.onHidden&&"function"!=typeof o.onHidden&&(o.onHidden=null);let l=document.createElement("div"),e=(l.innerHTML=`
<div class="modal ${o.size}" tabindex="-1" ${!1===o.backdrop?'data-bs-backdrop="false"':"static"===o.backdrop?'data-bs-backdrop="static"':""} ${!1===o.keyboard?'data-bs-keyboard="false"':""} ${!1===o.focus?'data-bs-focus="false"':""}">
  <div class="modal-dialog ${o.centered?"modal-dialog-centered":""}">
    <div class="modal-content">
      ${null===o.title?"":`<div class="modal-header"><h5 class="modal-title">${o.title}</h5></div>`}
      ${null===o.body?"":`<div class="modal-body">${o.body}</div>`}
      ${null===o.btnAcceptText&&null===o.btnCancelText?"":`
      <div class="modal-footer">
        ${null===o.btnCancelText?"":`<button type="button" class="btn ${o.btnCancelClass}" data-bs-dismiss="modal">${o.btnCancelText}</button>`}
        ${null===o.btnAcceptText?"":`<button type="button" class="btn ${o.btnAcceptClass}">${o.btnAcceptText}</button>`}
      </div>`}
    </div>
  </div>
</div>`,l.querySelector(".btn-primary")),s=l.querySelector(".btn-secondary"),c=l.querySelector(".modal"),a=(document.body.appendChild(l),new bootstrap.Modal(c));o=Object.assign({},DEFAULT_MODAL_OPTIONS,o||{});var t=new Promise((t,n)=>{o.btnAcceptText&&e.addEventListener("click",e=>{o.onAccept&&"function"==typeof o.onAccept&&o.onAccept(e,c),t("accept"),a.hide()},{once:!0}),o.btnCancelText&&s.addEventListener("click",e=>{o.onCancel&&"function"==typeof o.onCancel&&o.onCancel(e,c),n("cancel"),a.hide()},{once:!0}),!0===o.keyboard&&c.addEventListener("keydown",e=>{"Escape"===e.key&&(o.onCancel&&"function"==typeof o.onCancel&&o.onCancel(e,c),n("cancel"),a.hide())},{once:!0}),o.onShow&&"function"==typeof o.onShow&&c.addEventListener("show.bs.modal",e=>{o.onShow(e,c)},{once:!0}),o.onShown&&"function"==typeof o.onShown&&c.addEventListener("shown.bs.modal",e=>{o.onShown(e,c)},{once:!0}),o.onHide&&"function"==typeof o.onHide&&c.addEventListener("hide.bs.modal",e=>{o.onHide(e,c)},{once:!0}),o.onHidden&&"function"==typeof o.onHidden&&c.addEventListener("hidden.bs.modal",e=>{o.onHidden(e,c)},{once:!0}),c.addEventListener("hide.bs.modal",function(e){document.activeElement&&document.activeElement.blur()}),c.addEventListener("hidden.bs.modal",e=>{a.dispose(),l.remove()},{once:!0})});return a.show(),t.modal=a,t}}(window);